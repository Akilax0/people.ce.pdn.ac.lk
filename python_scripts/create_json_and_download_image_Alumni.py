# Create json file in _data/stud/*.json + download image using information taken from javascript code
#  https://cepdnaclk.github.io/department-website-2013/people/e08.html
# Author: E/18/098 Ishan Fernando - e18098@eng.pdn.ac.lk

# run js on site
"""
output = {};
list1 = document.getElementsByTagName("tr");
let count = 0;
for (let i = 0; i < list1.length; i=i+1) {
  output[count] = { name : list1[i].getElementsByTagName("th")[0].innerText , image : list1[i].getElementsByTagName("th")[1].getElementsByTagName("a")[0].href }
  count = count + 1;
  output[count] = { name : list1[i].getElementsByTagName("th")[3].innerText , image : list1[i].getElementsByTagName("th")[4].getElementsByTagName("a")[0].href }
  count = count + 1;
}
JSON.stringify(output)
"""

import urllib.request
import json


# the output,

outputFromJavaScript = """
{"0":{"name":"e07004 - H.M.T.B. Abyrathna","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/004.JPG"},"1":{"name":"e07015 - W.D.M.S. Amarasena","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/015.JPG"},"2":{"name":"e07016 - A.A.S.B. Amarasinghe","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/016.JPG"},"3":{"name":"e07022 - D.A.P. Arachchi","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/022.JPG"},"4":{"name":"e07026 - M.R.P.P. Ariyarathna","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/026.JPG"},"5":{"name":"e07029 - S. Arunan","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/029.JPG"},"6":{"name":"e07043 - A.S. Barnes","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/043.JPG"},"7":{"name":"e07054 - J.M.M.U. Dasanayake","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/054.JPG"},"8":{"name":"e07058 - T.U.I. De silva","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/058.JPG"},"9":{"name":"e07064 - K.P.C.I. Darmarathna","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/064.JPG"},"10":{"name":"e07068 - M.N.M. Dilshard","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/068.JPG"},"11":{"name":"e07069 - K. Dilshan","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/069.JPG"},"12":{"name":"e07083 - D.R.D. Dunusinghe","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/083.JPG"},"13":{"name":"e07094 - A.M.A. Faheem","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/094.JPG"},"14":{"name":"e07097 - I.G.N. Fernando","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/097.JPG"},"15":{"name":"e07100 - P.V.R.S.R. Fernando","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/100.JPG"},"16":{"name":"e07116 - M.P.I. Gunawardana","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/116.JPG"},"17":{"name":"e07117 - P.K.S.L. Gunawardana","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/117.JPG"},"18":{"name":"e07119 - S.C.D.H.W.M.C.P. Hapukotuwa","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/119.JPG"},"19":{"name":"e07121 - A.U.A. Hemachandra","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/121.JPG"},"20":{"name":"e07123 - H.H.T.S. Herath","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/123.JPG"},"21":{"name":"e07125 - H.M.D.K. Herath","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/125.JPG"},"22":{"name":"e07126 - H.M.P.L. Herath","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/126.JPG"},"23":{"name":"e07127 - H.M.P.U. Herath","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/127.JPG"},"24":{"name":"e07137 - V.C. Ilanthalaisingam","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/137.JPG"},"25":{"name":"e07163 - M.Z. Junaideen","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/163.JPG"},"26":{"name":"e07167 - T.M. Kamburapola","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/167.JPG"},"27":{"name":"e07178 - H.M.U.P. Karuarathne","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/178.JPG"},"28":{"name":"e07188 - A.S. Kularathanam","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/188.JPG"},"29":{"name":"e07199 - K.K.D.C. Lakmali","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/199.JPG"},"30":{"name":"e07210 - H.K.S. Madhusanka","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/210.JPG"},"31":{"name":"e07214 - N. Mahasivam","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/214.JPG"},"32":{"name":"e07215 - M.D.S.N. Mahawattha","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/215.JPG"},"33":{"name":"e07223 - W.W.S.M. Mendis","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/223.JPG"},"34":{"name":"e07224 - T.M.K.N. Mettananda","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/224.JPG"},"35":{"name":"e07228 - P.R.I. Mohamed","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/228.JPG"},"36":{"name":"e07246 - U. Patricia","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/246.JPG"},"37":{"name":"e07248 - P.T.C. Pathirannaha","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/248.JPG"},"38":{"name":"e07250 - R.M.S. Peiris","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/250.JPG"},"39":{"name":"e07251 - B.Y.C.A. Perera","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/251.JPG"},"40":{"name":"e07264 - A. Pratheep","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/264.JPG"},"41":{"name":"e07267 - N.K.M. Priyadarshana","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/267.JPG"},"42":{"name":"e07273 - E.A.P.S. Rahal","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/273.JPG"},"43":{"name":"e07274 - M. Rajakaruna","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/274.JPG"},"44":{"name":"e07275 - R.B.M.R. Rajapaksha","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/275.JPG"},"45":{"name":"e07276 - R.M.D.T.N. Rajapaksha","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/276.JPG"},"46":{"name":"e07284 - R.M.W.U. Rathnasekara","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/284.JPG"},"47":{"name":"e07286 - M.C. Rathnayake","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/286.JPG"},"48":{"name":"e07309 - N.D.M. Samarakoon","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/309.JPG"},"49":{"name":"e07332 - S.A.L.D. Senadheera","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/332.JPG"},"50":{"name":"e07335 - P.M.U.C.B. Senanayake","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/335.JPG"},"51":{"name":"e07337 - B.S. Senduran","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/337.JPG"},"52":{"name":"e07344 - M.M.N. Shaweendra","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/344.JPG"},"53":{"name":"e07349 - K.D.N.I.S. Siriwardana","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/349.JPG"},"54":{"name":"e07355 - K. Sriskantharajah","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/355.JPG"},"55":{"name":"e07370 - W.M.C. Thiwanka","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/370.JPG"},"56":{"name":"e07373 - K.P.T. Udara","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/373.JPG"},"57":{"name":"e07376 - N. Vahissa","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/376.JPG"},"58":{"name":"e07393 - N.G.N.P. Wijepala","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/393.JPG"},"59":{"name":"e07412 - O.J.S. Rupananda","image":"https://cepdnaclk.github.io/department-website-2013/people/images/e07/originals/412.JPG"}}

"""

data = json.loads(outputFromJavaScript)
outputJSON = {}

for i in range(len(data)):
    name = data[str(i)]["name"]
    batch = int(name[1:3])
    regNo = int(name[3:6])
    url = data[str(i)]["image"]
    name = name.split("-")[1].strip()
    print(name, batch, regNo, url)
    image_path = f"images/students/e{str(batch).zfill(2)}/e{str(batch).zfill(2)}{str(regNo).zfill(3)}.jpg"
    outputJSON[str(f"E/{str(batch).zfill(2)}/{str(regNo).zfill(3)}")] = {"reg_no": f"E/{str(batch).zfill(2)}/{str(regNo).zfill(3)}",
                                                                         "name_with_initials": name,
                                                                         "image_url": image_path}
    urllib.request.urlretrieve(url, "../"+image_path)


outputJSONFile = open(f"../_data/stud/e{str(batch).zfill(2)}.json", "w")
outputJSONFile.write(json.dumps(outputJSON, indent=4))
outputJSONFile.close()
